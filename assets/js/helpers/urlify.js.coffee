EMOTICONS =
  '#-o': '<img src="http://jupo.s3.amazonaws.com/emoticons/40.gif" alt="d\'oh">',
  '#:-S': '<img src="http://jupo.s3.amazonaws.com/emoticons/18.gif" alt="whew!">',
  '>-)': '<img src="http://jupo.s3.amazonaws.com/emoticons/61.gif" alt="alien">',
  '>:)': '<img src="http://jupo.s3.amazonaws.com/emoticons/19.gif" alt="devil">',
  '>:D<': '<img src="http://jupo.s3.amazonaws.com/emoticons/6.gif" alt="big hug">',
  '>:P': '<img src="http://jupo.s3.amazonaws.com/emoticons/47.gif" alt="phbbbbt">',
  '<):)': '<img src="http://jupo.s3.amazonaws.com/emoticons/48.gif" alt="cowboy">',
  '<:-P': '<img src="http://jupo.s3.amazonaws.com/emoticons/36.gif" alt="party">',
  '<:o)': '<img src="http://jupo.s3.amazonaws.com/emoticons/36.gif" alt="party">',
  '(%)': '<img src="http://jupo.s3.amazonaws.com/emoticons/75.gif" alt="yin yang">',
  '(*)': '<img src="http://jupo.s3.amazonaws.com/emoticons/79.gif" alt="star">',
  '(:|': '<img src="http://jupo.s3.amazonaws.com/emoticons/37.gif" alt="yawn">',
  '**==': '<img src="http://jupo.s3.amazonaws.com/emoticons/55.gif" alt="flag">',
  '/:)': '<img src="http://jupo.s3.amazonaws.com/emoticons/23.gif" alt="raised eyebrows">',
  '8->': '<img src="http://jupo.s3.amazonaws.com/emoticons/105.gif" alt="day dreaming">',
  '8-X': '<img src="http://jupo.s3.amazonaws.com/emoticons/59.gif" alt="skull">',
  '8-)': '<img src="http://jupo.s3.amazonaws.com/emoticons/29.gif" alt="rolling eyes">',
  '8-}': '<img src="http://jupo.s3.amazonaws.com/emoticons/35.gif" alt="silly">',
  ':!!': '<img src="http://jupo.s3.amazonaws.com/emoticons/110.gif" alt="hurry up!">',
  ':">': '<img src="http://jupo.s3.amazonaws.com/emoticons/9.gif" alt="blushing">',
  ':>': '<img src="http://jupo.s3.amazonaws.com/emoticons/15.gif" alt="smug">',
  ':(': '<img src="http://jupo.s3.amazonaws.com/emoticons/2.gif" alt="sad">',
  ':-(': '<img src="http://jupo.s3.amazonaws.com/emoticons/2.gif" alt="sad">',
  ':((': '<img src="http://jupo.s3.amazonaws.com/emoticons/20.gif" alt="crying">',
  ":'(": '<img src="http://jupo.s3.amazonaws.com/emoticons/20.gif" alt="crying">',
  ':(|)': '<img src="http://jupo.s3.amazonaws.com/emoticons/51.gif" alt="monkey">',
  ':)': '<img src="http://jupo.s3.amazonaws.com/emoticons/1.gif" alt="happy">',
  ':-)': '<img src="http://jupo.s3.amazonaws.com/emoticons/1.gif" alt="happy">',
  ':)>-': '<img src="http://jupo.s3.amazonaws.com/emoticons/67.gif" alt="peace sign">',
  ':))': '<img src="http://jupo.s3.amazonaws.com/emoticons/21.gif" alt="laughing">',
  ':)]': '<img src="http://jupo.s3.amazonaws.com/emoticons/100.gif" alt="on the phone">',
  ':-"': '<img src="http://jupo.s3.amazonaws.com/emoticons/65.gif" alt="whistling">',
  ':-$': '<img src="http://jupo.s3.amazonaws.com/emoticons/32.gif" alt="don\'t tell anyone">',
  ':$': '<img src="http://jupo.s3.amazonaws.com/emoticons/32.gif" alt="don\'t tell anyone">',
  ':-#': '<img src="http://jupo.s3.amazonaws.com/emoticons/32.gif" alt="don\'t tell anyone">',
  ':-&': '<img src="http://jupo.s3.amazonaws.com/emoticons/31.gif" alt="sick">',
  ':-<': '<img src="http://jupo.s3.amazonaws.com/emoticons/46.gif" alt="sigh">',
  ':-*': '<img src="http://jupo.s3.amazonaws.com/emoticons/11.gif" alt="kiss">',
  ':-/': '<img src="http://jupo.s3.amazonaws.com/emoticons/7.gif" alt="confused">',
  ':-?': '<img src="http://jupo.s3.amazonaws.com/emoticons/39.gif" alt="thinking">',
  '*-)': '<img src="http://jupo.s3.amazonaws.com/emoticons/39.gif" alt="thinking">',
  ':-??': '<img src="http://jupo.s3.amazonaws.com/emoticons/106.gif" alt="I don\'t know">',
  ':^)': '<img src="http://jupo.s3.amazonaws.com/emoticons/106.gif" alt="I don\'t know">',
  ':-B': '<img src="http://jupo.s3.amazonaws.com/emoticons/26.gif" alt="nerd">',
  '8-|': '<img src="http://jupo.s3.amazonaws.com/emoticons/26.gif" alt="nerd">',
  ':-O': '<img src="http://jupo.s3.amazonaws.com/emoticons/13.gif" alt="surprise">',
  ':o': '<img src="http://jupo.s3.amazonaws.com/emoticons/13.gif" alt="surprise">',
  ':-SS': '<img src="http://jupo.s3.amazonaws.com/emoticons/42.gif" alt="nail biting">',
  ':-ss': '<img src="http://jupo.s3.amazonaws.com/emoticons/42.gif" alt="nail biting">',
  ':-S': '<img src="http://jupo.s3.amazonaws.com/emoticons/17.gif" alt="worried">',
  ':-s': '<img src="http://jupo.s3.amazonaws.com/emoticons/17.gif" alt="worried">',
  ':s': '<img src="http://jupo.s3.amazonaws.com/emoticons/17.gif" alt="worried">',
  ':-bd': '<img src="http://jupo.s3.amazonaws.com/emoticons/113.gif" alt="thumbs up">',
  ':-c': '<img src="http://jupo.s3.amazonaws.com/emoticons/101.gif" alt="call me">',
  ':-h': '<img src="http://jupo.s3.amazonaws.com/emoticons/103.gif" alt="wave">',
  ':-q': '<img src="http://jupo.s3.amazonaws.com/emoticons/112.gif" alt="thumbs down">',
  ':-t': '<img src="http://jupo.s3.amazonaws.com/emoticons/104.gif" alt="time out">',
  ':-w': '<img src="http://jupo.s3.amazonaws.com/emoticons/45.gif" alt="waiting">',
  ':@)': '<img src="http://jupo.s3.amazonaws.com/emoticons/49.gif" alt="pig">',
  ':D': '<img src="http://jupo.s3.amazonaws.com/emoticons/4.gif" alt="big grin">',
  ':-D': '<img src="http://jupo.s3.amazonaws.com/emoticons/4.gif" alt="big grin">',
  ':d': '<img src="http://jupo.s3.amazonaws.com/emoticons/4.gif" alt="big grin">',
  ':O)': '<img src="http://jupo.s3.amazonaws.com/emoticons/34.gif" alt="clown">',
  ':P': '<img src="http://jupo.s3.amazonaws.com/emoticons/10.gif" alt="tongue">',
  ':p': '<img src="http://jupo.s3.amazonaws.com/emoticons/10.gif" alt="tongue">',
  ':-P': '<img src="http://jupo.s3.amazonaws.com/emoticons/10.gif" alt="tongue">',
  ':^o': '<img src="http://jupo.s3.amazonaws.com/emoticons/44.gif" alt="liar">',
  ':ar!': '<img src="http://jupo.s3.amazonaws.com/emoticons/pirate_2.gif" alt="pirate">',
  ':x': '<img src="http://jupo.s3.amazonaws.com/emoticons/8.gif" alt="love struck">',
  ':|': '<img src="http://jupo.s3.amazonaws.com/emoticons/22.gif" alt="straight face">',
  ':-|': '<img src="http://jupo.s3.amazonaws.com/emoticons/22.gif" alt="straight face">',
  ';)': '<img src="http://jupo.s3.amazonaws.com/emoticons/3.gif" alt="winking">',
  ';-)': '<img src="http://jupo.s3.amazonaws.com/emoticons/3.gif" alt="winking">',
  ';))': '<img src="http://jupo.s3.amazonaws.com/emoticons/71.gif" alt="hee hee">',
  ';;)': '<img src="http://jupo.s3.amazonaws.com/emoticons/5.gif" alt="batting eyelashes">',
  '=((': '<img src="http://jupo.s3.amazonaws.com/emoticons/12.gif" alt="broken heart">',
  '=))': '<img src="http://jupo.s3.amazonaws.com/emoticons/24.gif" alt="rolling on the floor">',
  '=;': '<img src="http://jupo.s3.amazonaws.com/emoticons/27.gif" alt="talk to the hand">',
  '=D>': '<img src="http://jupo.s3.amazonaws.com/emoticons/41.gif" alt="applause">',
  '=P~': '<img src="http://jupo.s3.amazonaws.com/emoticons/38.gif" alt="drooling">',
  '@-)': '<img src="http://jupo.s3.amazonaws.com/emoticons/43.gif" alt="hypnotized">',
  '@};-': '<img src="http://jupo.s3.amazonaws.com/emoticons/53.gif" alt="rose">',
  'B-)': '<img src="http://jupo.s3.amazonaws.com/emoticons/16.gif" alt="cool">',
  'I-)': '<img src="http://jupo.s3.amazonaws.com/emoticons/28.gif" alt="sleepy">',
  '|-)': '<img src="http://jupo.s3.amazonaws.com/emoticons/28.gif" alt="sleepy">',
  'L-)': '<img src="http://jupo.s3.amazonaws.com/emoticons/30.gif" alt="loser">',
  'O:-)': '<img src="http://jupo.s3.amazonaws.com/emoticons/25.gif" alt="angel">',
  'X(': '<img src="http://jupo.s3.amazonaws.com/emoticons/14.gif" alt="angry">',
  ':@': '<img src="http://jupo.s3.amazonaws.com/emoticons/14.gif" alt="angry">',
  ':-@': '<img src="http://jupo.s3.amazonaws.com/emoticons/14.gif" alt="angry">',
  'X_X': '<img src="http://jupo.s3.amazonaws.com/emoticons/109.gif" alt="I don\'t want to see">',
  '[-(': '<img src="http://jupo.s3.amazonaws.com/emoticons/33.gif" alt="no talking">',
  '[-O<': '<img src="http://jupo.s3.amazonaws.com/emoticons/63.gif" alt="praying">',
  '[..]': '<img src="http://jupo.s3.amazonaws.com/emoticons/transformer.gif" alt="transformer*">',
  '\\:D/': '<img src="http://jupo.s3.amazonaws.com/emoticons/69.gif" alt="dancing">',
  '\\m/': '<img src="http://jupo.s3.amazonaws.com/emoticons/111.gif" alt="rock on!">',
  '^#(^': '<img src="http://jupo.s3.amazonaws.com/emoticons/114.gif" alt="it wasn\'t me">',
  '^:)^': '<img src="http://jupo.s3.amazonaws.com/emoticons/77.gif" alt="not worthy">',
  'o=>': '<img src="http://jupo.s3.amazonaws.com/emoticons/73.gif" alt="billy">',
  '~O)': '<img src="http://jupo.s3.amazonaws.com/emoticons/57.gif" alt="coffee">',
  '~X(': '<img src="http://jupo.s3.amazonaws.com/emoticons/102.gif" alt="at wits\' end">',
  ':-L': '<img src="http://jupo.s3.amazonaws.com/emoticons/62.gif" alt="frustrated">',
  '(y)': '<img src="http://jupo.s3.amazonaws.com/emoticons/thumbs-up.png" alt="thumbs up">'


LIST_EMOTICONS = (key for key of EMOTICONS).sort().reverse()

urlify = (rawText) ->
  urlRegex = /(https?:\/\/[^\s]+)/g
  rawText.replace urlRegex, (url) ->
    if url.length > 30
      urlText = "#{url.substr(0, 27)}..."
    else
      urlText = url

    text = "<a target=\"_blank\" href=\"#{url}\">#{urlText}</a>"
    if url.isImage()
      text += "<br /><img src=\"#{url}\" width=200 />"
    text


Ember.Handlebars.registerBoundHelper "urlify", (rawText) ->
  text = urlify(rawText)
  for key in LIST_EMOTICONS
    text = text.replace(key, EMOTICONS[key])
  new Handlebars.SafeString text
